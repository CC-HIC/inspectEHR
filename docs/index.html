<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Quality Reporting for CC-HIC • inspectEHR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Data Quality Reporting for CC-HIC">
<meta property="og:description" content="This package helps to produce data quality reports for CC-HIC.
    This consists of data wrangling, cleaning, verification and validation.
    There are a lot of helper functions that have been written to facilitate
    data wrangling and cleaning. These need to be separated and ported to
    cleanEHR in due course.">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">inspectEHR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/extract_data.html">How to extract data using inspectEHR</a>
    </li>
    <li>
      <a href="articles/overview.html">An overview of inspectEHR</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/CC-HIC/inspectEHR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="inspectehr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#inspectehr" class="anchor"></a>inspectEHR <a href="https://cc-hic.github.io/inspectEHR/"><img src="reference/figures/logo.png" align="right" height="139"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>inspectEHR is a data wrangling, cleaning and reporting tool for CC-HIC. It is designed to run against the CC-HIC EAV table structure (which at present exists in PostgreSQL and SQLite flavours). We are about to undergo a major rewrite to a OHDSI CDM version 6, so this package will be in flux. Once these functions have been ported across and tested, we will aim to submit to CRAN. Please see the <code>R</code> vignettes for further details on how to use the package to perform the most common tasks:</p>
<ul>
<li>
<code><a href="reference/extract_demographics.html">extract_demographics()</a></code> produces a table for time invariant variables</li>
<li>
<code><a href="reference/extract_timevarying.html">extract_timevarying()</a></code> produces a table for longitudinal variables</li>
<li>
<code><a href="reference/clean.html">clean()</a></code> cleans the above tables according to pre-defined standards.</li>
<li>
<code><a href="reference/report.html">report()</a></code> produces a data quality report (note, being fixed for IDHS usage)</li>
<li>
<code>shiny_report()</code> starts an interactive shiny session for the data quality reports (under development)</li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install directly from github with</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(devtools)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"cc-hic/inspectEHR"</span>)</a></code></pre></div>
<p>A copy should already be installed into the group library for the CC-HIC team inside the UCL safe haven. If you are having problems with this, please contact me directly.</p>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>A synthetic database with 1000 patients ships with inspectEHR for you to explore. Actual values are garbage, but everything is internally consistent. The code to produce a more comprehensive synthetic test database is found in <code>data-raw/write_synthetic_data.R</code>. We have skimmmed off the first 1000 patients so as to not make the synehtic database combersome.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(inspectEHR); <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dbplyr)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># Synthetic database ships with inspectEHR</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">db_pth &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"testdata/synthetic_db.sqlite3"</span>, <span class="dt">package =</span> <span class="st">"inspectEHR"</span>)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">ctn &lt;-<span class="st"> </span><span class="kw"><a href="reference/connect.html">connect</a></span>(<span class="dt">sqlite_file =</span> db_pth)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># Extract static variables. Rename on the fly.</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">dtb &lt;-<span class="st"> </span><span class="kw"><a href="reference/extract_demographics.html">extract_demographics</a></span>(</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="dt">connection =</span> ctn,</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">  <span class="dt">episode_ids =</span> <span class="dv">13639</span><span class="op">:</span><span class="dv">13643</span>,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="dt">code_names =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"NIHR_HIC_ICU_0017"</span>, <span class="st">"NIHR_HIC_ICU_0019"</span>),</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  <span class="dt">rename =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"height"</span>, <span class="st">"weight"</span>)</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(dtb)</a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt; # A tibble: 5 x 2</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt;   episode_id height</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt;        &lt;int&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; 1      13639   150.</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; 2      13640   173.</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt; 3      13641   143.</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; 4      13642   156.</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; 5      13643   168.</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co"># Extract time varying variables. Rename on the fly.</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co"># Pull out to any arbitrary temporal resolution and custom define the</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co"># behaviour for information recorded at resolution higher than you are sampling</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28">ltb &lt;-<span class="st"> </span><span class="kw"><a href="reference/extract_timevarying.html">extract_timevarying</a></span>(</a>
<a class="sourceLine" id="cb2-29" data-line-number="29">  <span class="dt">connection =</span> ctn,</a>
<a class="sourceLine" id="cb2-30" data-line-number="30">  <span class="dt">code_names =</span>  <span class="st">"NIHR_HIC_ICU_0108"</span>, <span class="dt">rename =</span> <span class="st">"hr"</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31">)</a>
<a class="sourceLine" id="cb2-32" data-line-number="32"></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(ltb)</a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="co">#&gt; # A tibble: 6 x 3</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="co">#&gt;    time    hr episode_id</span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="co">#&gt;   &lt;dbl&gt; &lt;int&gt;      &lt;int&gt;</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"><span class="co">#&gt; 1     0    69      13626</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="co">#&gt; 2     1    93      13626</span></a>
<a class="sourceLine" id="cb2-39" data-line-number="39"><span class="co">#&gt; 3     2    86      13626</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"><span class="co">#&gt; 4     3    93      13626</span></a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="co">#&gt; 5     4    63      13626</span></a>
<a class="sourceLine" id="cb2-42" data-line-number="42"><span class="co">#&gt; # … with 1 more row</span></a></code></pre></div>
</div>
<div id="getting-help" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-help" class="anchor"></a>Getting help</h2>
<p>If you find a bug, please file a minimal reproducible example on <a href="https://github.com/cc-hic/inspectEHR/issues">github</a>.</p>
</div>
<div id="reporting-data-quality-issues" class="section level2">
<h2 class="hasAnchor">
<a href="#reporting-data-quality-issues" class="anchor"></a>Reporting Data Quality Issues</h2>
<p>Please submit an issue and tag it with “data quality”. Data quality issues are often related to a specific site. If this is the case, please also tag the site.</p>
</div>
<div id="data-quality-rules" class="section level2">
<h2 class="hasAnchor">
<a href="#data-quality-rules" class="anchor"></a>Data Quality Rules</h2>
<p>The data quality rules are largely based upon standards set by OHDSI<sup>1</sup>, and the consensus guidelines by Khan et al.<sup>2</sup>. The CC-HIC currently uses an episode centric model. As such, many of the data quality checks are based around this way of thinking. As we move to OMOP (a patient centric model) many of these will change accordingly. General conventions follow that:</p>
<ul>
<li>Verification refers to an intenal check of the data, possibly against a data specification or domain knowledge.</li>
<li>Validation refers to an external check of the data, against a secondary resource that is known to be trusted.</li>
</ul>
<div id="episode-verification" class="section level3">
<h3 class="hasAnchor">
<a href="#episode-verification" class="anchor"></a>Episode Verification</h3>
<ul>
<li>Internal consistency check of episode
<ul>
<li>Each episode has a unique identifier</li>
<li>Each episode has a start date</li>
<li>Each episode has an end date defined by one of:
<ul>
<li>End of episode date time (often administrative in nature and used with caution)</li>
<li>On unit death date time from any means
<ul>
<li>Death</li>
<li>Brain stem Death (BSD)</li>
<li>“Body Removal”: strongly suggesting death</li>
</ul>
</li>
<li>The last measured bedside physiological result (HR and SpO2)</li>
</ul>
</li>
<li>Death (other than BSD) cannot occur before the last caputre of a direct physiological measure (e.g. a heart rate, or a blood pressure), but could occur before the return of a lab measure (e.g. a CRP or a pathology result)</li>
<li>Records that are flagged as “open” are dropped.</li>
</ul>
</li>
</ul>
</div>
<div id="eventvalue-verification" class="section level3">
<h3 class="hasAnchor">
<a href="#eventvalue-verification" class="anchor"></a>Event/Value Verification</h3>
<ul>
<li>Value conformance: data conforms to accepted type and formatting constraints</li>
<li>Relational conformance: unique keys are not duplicated and there are no orphaned rows in the database</li>
<li>Computational conformance: calculated and contributed values agree with oneanother
<ul>
<li>e.g. BMI (derived from height and weight) in plausible range and agree with a contributed BMI</li>
<li>e.g. APACHE in plausible range and agree with a contributed APACHE</li>
</ul>
</li>
<li>Completeness: contributed data items match local capability (i.e. missingness only occurs when the data doesn’t exist)</li>
<li>Plausibility:
<ul>
<li>Uniqueness plausibility: descriptions of singular events/objects are not duplicated</li>
<li>Atemporal plausibility:
<ul>
<li>Events occur within their episode (within a reasonable buffer time)</li>
<li>Events fall within an accepted range, follow the expected distribution and agree with internal/local knowledge</li>
<li>Distributions for independent measures of the same fact are in agreement:
<ul>
<li>e.g. Systolic &gt; MAP &gt; Diastolic</li>
<li>e.g. blood gas sodium and lab sodium</li>
<li>e.g. menorrhagia diagnosis only linked to female sex</li>
</ul>
</li>
<li>Repeated measures of the same event show the expected variability</li>
</ul>
</li>
<li>Temporal plausibility:
<ul>
<li>Observed values, and sequences of values that represent state transitions, correspond to an expected temporal property:
<ul>
<li>e.g. Hosp Admission -&gt; ICU Admission -&gt; ICU Discharge -&gt; Hosp Discharge</li>
</ul>
</li>
<li>Value density over time are consistent with local expectations
<ul>
<li>e.g. busy and quiet periods are reflected in the data</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div id="event-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#event-validation" class="anchor"></a>Event Validation</h3>
<p>The same principles listed above can be retested under a validation framework. That is to seak an external resource to validate the values in question. An aim is to check the data against the ICNARC reports, which will allows for some external validation against a gold standard resource. At present, the validation that is performed is to compaire all sites against each other. In this sense, each site is used as a validation check against the others. Distrepancies should either be due to systemic errors, or differences in casemix.</p>
</div>
</div>
<div id="synthetic-database" class="section level2">
<h2 class="hasAnchor">
<a href="#synthetic-database" class="anchor"></a>Synthetic Database</h2>
<p>There is a copy of the CC-HIC database located in <code>data-raw/synthetic_db.sqlite3</code>. This is a structurally sound copy of the real database, but entirely hand crafted (so there is no patient data here). It is quite sparse at present, but I will add more variables as time goes on. For now, it acts as a test database to make sure inspectEHR works as it should.</p>
<hr>
<ol style="list-style-type: decimal">
<li><a href="https://www.ohdsi.org/analytic-tools/achilles-for-data-characterization/" class="uri">https://www.ohdsi.org/analytic-tools/achilles-for-data-characterization/</a></li>
<li>Kahn, Michael G.; Callahan, Tiffany J.; Barnard, Juliana; Bauck, Alan E.; Brown, Jeff; Davidson, Bruce N.; Estiri, Hossein; Goerg, Carsten; Holve, Erin; Johnson, Steven G.; Liaw, Siaw-Teng; Hamilton-Lopez, Marianne; Meeker, Daniella; Ong, Toan C.; Ryan, Patrick; Shang, Ning; Weiskopf, Nicole G.; Weng, Chunhua; Zozus, Meredith N.; and Schilling, Lisa (2016) “A Harmonized Data Quality Assessment Terminology and Framework for the Secondary Use of Electronic Health Record Data,” eGEMs (Generating Evidence &amp; Methods to improve patient outcomes): Vol. 4: Iss. 1, Article 18.</li>
</ol>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/CC-HIC/inspectEHR">https://​github.com/​CC-HIC/​inspectEHR</a>
</li>
<li>Report a bug at <br><a href="https://github.com/CC-HIC/inspectEHR">https://​github.com/​CC-HIC/​inspectEHR</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Edward Palmer <br><small class="roles"> Author, maintainer </small>  <br><small>(<https:>)</https:></small>
</li>
</ul>
</div>

      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Edward Palmer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
