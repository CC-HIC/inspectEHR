<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract &amp; Reshape Timevarying Dateitems — extract_timevarying • inspectEHR</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Extract &amp; Reshape Timevarying Dateitems — extract_timevarying" />
<meta property="og:description" content="This is the workhorse function that transcribes 2d data from CC-HIC to a
table with 1 column per dataitem (and any metadata if relevent) and 1 row per
time per patient." />
<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">inspectEHR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.10.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/data_quality_report.html">How to make a data quality report</a>
    </li>
    <li>
      <a href="../articles/extract_data.html">How to extract data using inspectEHR</a>
    </li>
    <li>
      <a href="../articles/overview.html">An overview of inspectEHR</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/CC-HIC/inspectEHR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract &amp; Reshape Timevarying Dateitems</h1>
    <small class="dont-index">Source: <a href='https://github.com/CC-HIC/inspectEHR/blob/master/R/extract_timevarying.R'><code>R/extract_timevarying.R</code></a></small>
    <div class="hidden name"><code>extract_timevarying.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is the workhorse function that transcribes 2d data from CC-HIC to a
table with 1 column per dataitem (and any metadata if relevent) and 1 row per
time per patient.</p>
    </div>

    <pre class="usage"><span class='fu'>extract_timevarying</span>(
  <span class='no'>connection</span>,
  <span class='kw'>episode_ids</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>code_names</span>,
  <span class='kw'>rename</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='fl'>NA</span>),
  <span class='kw'>coalesce_rows</span> <span class='kw'>=</span> <span class='kw pkg'>dplyr</span><span class='kw ns'>::</span><span class='no'><a href='https://dplyr.tidyverse.org/reference/nth.html'>first</a></span>,
  <span class='kw'>chunk_size</span> <span class='kw'>=</span> <span class='fl'>5000</span>,
  <span class='kw'>cadance</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>time_boundaries</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>Inf</span>, <span class='fl'>Inf</span>)
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>connection</th>
      <td><p>a CC-HIC database connection</p></td>
    </tr>
    <tr>
      <th>episode_ids</th>
      <td><p>an integer vector of episode_ids or NULL. If NULL (the
default) then all episodes are extracted</p></td>
    </tr>
    <tr>
      <th>code_names</th>
      <td><p>a vector of CC-HIC codes names to be extracted</p></td>
    </tr>
    <tr>
      <th>rename</th>
      <td><p>a character vector of names you want to relabel CC-HIC codes
as, or NULL (the default) if you do not want to relabel. Given in the same
order as <code>code_names</code></p></td>
    </tr>
    <tr>
      <th>coalesce_rows</th>
      <td><p>a function vector of the summary functions that you want
to summarise data that is contributed higher than your set cadance. Given
in the same order as <code>code_names</code></p></td>
    </tr>
    <tr>
      <th>chunk_size</th>
      <td><p>a chunking parameter to help speed up the function and
manage memory constaints. The defaults work well for most desktop
computers.</p></td>
    </tr>
    <tr>
      <th>cadance</th>
      <td><p>a numerical scalar &gt;= 0 or "timestamp". If a numerical scalar
is used, it will describe the base time unit to build each row, in
divisions of an hour. For example: 1 = 1 hour, 0.5 = 30 mins, 2 = 2 hourly.
If multiple events occur within the specified time, then duplicate rows are
created. If cadance = 0, then the pricise datetime will be used to generate
the time column. This is likely to generate a large table, so use
cautiously.</p></td>
    </tr>
    <tr>
      <th>time_boundaries</th>
      <td><p>an integer vector of length 2 containing the start and
end times (in hours) relative to the ICU admission time, for which you want
data extraction to occur. For example, <code><a href='https://rdrr.io/r/base/c.html'>c(0, 24)</a></code> will return the
first 24 hours of data after admission. The default <code><a href='https://rdrr.io/r/base/c.html'>c(-Inf, Inf)</a></code>
will return all data.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>sparse tibble with hourly cadance as rows, and unique hic events as
  columns. Data items that contain metadata are reallocated to their own
  columns.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The time unit is user definable, and set by the "cadance" argument. The
default behaviour is to produce a table with 1 row per hour per patient. If
there are duplicates/conflicts (e.g more than 1 event for a given hour), then
only the first result for that hour is returned. One can override this
behvaiour by supplying a vector of summary functions directly to the
'coalesce_rows' argument.</p>
<p>Many events inside CC-HIC occur on a greater than hourly basis. Depending
upon the chosen analysis, you may which to increase the cadance. 0.5 for
example will produce a table with 1 row per 30 minutes per patient.</p>
<p>Where you are extacting at a resolution lower than is recorded in the
database, you can specify a summary function with the <code>coalesce_rows</code>
argument. This argument takes a summary function as an argument, for example,
'mean' and will apply this behaviour to the specified data items in the
database.</p>
<p>Choose what variables you want to pull out wisely. This function is actually
quite efficient considering what it needs to do, but it can take a very long
time if extracting lots of data. It is a strong recomendation that you
optimise the database with indexes prior to using this function. You may want
to test your extraction with 100 or so patients to make sure it is doing what
you want.</p>
<p>It is perfectly possible for this function to produce negative time rows. If,
for example a patient had a measure taken in the hours before they were
admitted, then this would be added to the table with a negative time value.
As a concrete example, if a patient had a sodium measured at 08:00, and they
were admitted to the ICU at 20:00 the same day, then the sodium would be
displayed at time = -12. This is normal behaviour it is left to the end user
to determine how best they wish to account for this.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># DB Connection</span>
<span class='no'>db_pth</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"testdata/synthetic_db.sqlite3"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"inspectEHR"</span>)
<span class='no'>ctn</span> <span class='kw'>&lt;-</span> <span class='fu'>connect</span>(<span class='kw'>sqlite_file</span> <span class='kw'>=</span> <span class='no'>db_pth</span>)

<span class='co'># Extract Heart Rates for 5 episodes with default settings</span>
<span class='no'>hr_default</span> <span class='kw'>&lt;-</span> <span class='fu'>extract_timevarying</span>(<span class='no'>ctn</span>, <span class='kw'>episode_ids</span> <span class='kw'>=</span> <span class='fl'>13639</span>:<span class='fl'>13643</span>, <span class='kw'>code_names</span> <span class='kw'>=</span> <span class='st'>"NIHR_HIC_ICU_0108"</span>)</div><div class='output co'>#&gt; <span class='message'>5.4e-05 hours to process</span></div><div class='output co'>#&gt; <span class='message'>MMHM! How sensational was that?!</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>hr_default</span>)</div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 6 x 3</span><span>
#&gt;    time NIHR_HIC_ICU_0108 episode_id
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>             </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span>     0                99      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>2</span><span>     1                84      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>3</span><span>     2               102      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>4</span><span>     3                95      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>5</span><span>     4                69      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>6</span><span>     5                76      </span><span style='text-decoration: underline;'>13</span><span>639</div><div class='input'><span class='co'># Extract Heart Rates for 5 episodes with custom settings</span>
<span class='no'>hr_custom</span> <span class='kw'>&lt;-</span> <span class='fu'>extract_timevarying</span>(<span class='no'>ctn</span>, <span class='kw'>episode_ids</span> <span class='kw'>=</span> <span class='fl'>13639</span>:<span class='fl'>13643</span>, <span class='kw'>code_names</span> <span class='kw'>=</span> <span class='st'>"NIHR_HIC_ICU_0108"</span>, <span class='kw'>cadance</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>coalesce_rows</span> <span class='kw'>=</span> <span class='no'>mean</span>)</div><div class='output co'>#&gt; <span class='message'>4.8e-05 hours to process</span></div><div class='output co'>#&gt; <span class='message'>YIKES! How unreal was that?!</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='no'>hr_custom</span>)</div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 6 x 3</span><span>
#&gt;    time NIHR_HIC_ICU_0108 episode_id
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>             </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span>     0                99      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>2</span><span>     2               102      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>3</span><span>     4                95      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>4</span><span>     6                90      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>5</span><span>     8                89      </span><span style='text-decoration: underline;'>13</span><span>639
#&gt; </span><span style='color: #555555;'>6</span><span>    10                96      </span><span style='text-decoration: underline;'>13</span><span>639</div><div class='input'><span class='kw pkg'>DBI</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/DBI/man/dbDisconnect.html'>dbDisconnect</a></span>(<span class='no'>ctn</span>)</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Edward Palmer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


